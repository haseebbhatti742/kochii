"use strict";var express=require("express"),router=express.Router(),app=require("../../app");router.get("/",function(s,e){null!=s.session.username&&"client"==s.session.type?(e.locals.title="Add Appointment",e.render("client/addAppointment")):null==s.session.username&&(e.locals.title="Login",e.render("client/login"))}),router.post("/getStylists",function(s,t){app.conn.query("SELECT * from employees WHERE employee_role!='receptionist'",function(s,e){s?console.log(s.message):0<e.length&&t.status(200).json({status:"yes",stylists:e})})}),router.post("/getServices",function(s,t){app.conn.query("SELECT * from services WHERE service_status='available'",function(s,e){s?console.log(s.message):0<e.length&&t.status(200).json({status:"yes",services:e})})}),router.post("/add",function(t,a){var i=JSON.parse(t.body.services),n=new Date(t.body.date);app.conn.getConnection(function(s,r){s?a.status(200).json({status:"error",msg:s.message}):r.beginTransaction(function(s){if(s)a.status(200).json({status:"error",msg:s.message});else{var e="INSERT INTO appointments(appointment_date,appointment_status,user_id) values('"+n+"','pending','"+t.session.username+"')";r.query(e,function(s,e){if(s)r.rollback(function(){a.status(200).json({status:"error",msg:s.message})});else for(var t=e.insertId,n=0;n<i.array.length;n++){var o="INSERT INTO appointment_services(appointment_id,service_id) values('"+t+"','"+i.array[n]+"')";r.query(o,function(s,e){s?r.rollback(function(){a.status(200).json({status:"error",msg:s.message})}):r.commit(function(s){s?r.rollback(function(){a.status(200).json({status:"error",msg:s.message})}):a.status(200).json({status:"yes"})})})}})}})})}),module.exports=router;